<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= title %> - GLA English</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #ecfdf5 0%, #e0f2fe 100%);
    }
    .notify {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 60;
      max-width: 320px;
    }
    .sidebar-transition {
      transition: transform 0.3s ease-in-out;
    }
    @media (max-width: 768px) {
      #sidebar.mobile-hidden {
        transform: translateX(-100%);
      }
    }
    .stat-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    }
    .lesson-card {
      transition: all 0.3s ease;
    }
    .lesson-card:hover {
      transform: scale(1.02);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="min-h-screen flex">

  <!-- Sidebar -->
  <aside id="sidebar" class="bg-white w-72 p-6 border-r border-gray-100 flex flex-col fixed h-full z-50 md:relative sidebar-transition">
    <div class="mb-8">
      <h1 class="text-2xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent">GLA English</h1>
      <p class="text-sm text-gray-500 mt-1">Welcome, <%= userName %></p>
    </div>

    <nav class="flex-1 space-y-2 overflow-y-auto">
      <a href="/dashboard" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-teal-50 to-cyan-50 text-teal-700 font-medium">
        <i class="fas fa-home w-5"></i>
        <span>Dashboard</span>
      </a>

      <!-- Lessons with subcategories -->
      <div class="space-y-1">
        <button onclick="toggleSubmenu('lessons')" class="w-full flex items-center justify-between px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
          <div class="flex items-center gap-3">
            <i class="fas fa-book-open w-5"></i>
            <span>Lessons</span>
          </div>
          <i id="lessons-arrow" class="fas fa-chevron-right text-xs transition-transform"></i>
        </button>
        <div id="lessons-submenu" class="hidden pl-6 space-y-1 mt-1">
          <a href="/dashboard/lessons/Grammar" class="flex items-center gap-3 px-4 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50 transition">
            <i class="fas fa-spell-check w-4"></i>
            <span>Grammar & Usage</span>
          </a>
          <a href="/dashboard/lessons/speaking" class="flex items-center gap-3 px-4 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50 transition">
            <i class="fas fa-microphone w-4"></i>
            <span>Speaking Skills</span>
          </a>
          <a href="/dashboard/lessons/Writting" class="flex items-center gap-3 px-4 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50 transition">
            <i class="fas fa-pen w-4"></i>
            <span>Writing Practice</span>
          </a>
        </div>
      </div>

      <a href="/dashboard/vocabulary" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-brain w-5"></i>
        <span>Vocabulary</span>
      </a>

      <a href="/dashboard/test" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-clipboard-check w-5"></i>
        <span>Tests & Assessments</span>
      </a>

      <a href="/dashboard/resume" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-file-alt w-5"></i>
        <span>Resume & Writing Lab</span>
      </a>

      <a href="/dashboard/placement" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-graduation-cap w-5"></i>
        <span>Placement Resources</span>
      </a>

      <a href="/dashboard/profile" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-user w-5"></i>
        <span>My Profile</span>
      </a>

      <a href="/dashboard/setting" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-cog w-5"></i>
        <span>Settings</span>
      </a>
       <a href="/dashboard/ai" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-gray-50 font-medium transition">
        <i class="fas fa-cog w-5"></i>
        <span>Ai Feedback System</span>
      </a>
    </nav>

    <div class="mt-6 pt-6 border-t border-gray-100">
      <a href="/logout" class="flex items-center justify-center gap-2 text-red-600 py-3 rounded-xl hover:bg-red-50 font-medium transition">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </a>
    </div>
  </aside>

  

  <!-- Main content -->
  <div class="flex-1 md:ml-0">
    <div class="p-6 md:p-10">
      <!-- Top bar -->
      <header class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-4">
          

          <div>
            <h2 class="text-3xl font-bold text-gray-800">
              Welcome back, <span class="bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent"><%= userName %></span>
            </h2>
            <p class="text-sm text-gray-500 mt-1">Keep going — your progress looks great!</p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button id="notifBtn" class="p-3 bg-white rounded-xl shadow-md hover:shadow-lg transition relative">
            <i class="fas fa-bell text-gray-600"></i>
            <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
          </button>
          <a href="/dashboard/profile" class="w-11 h-11 rounded-xl bg-gradient-to-r from-teal-500 to-cyan-500 flex items-center justify-center text-white font-bold hover:scale-105 transition shadow-md">
            <%= userName.charAt(0).toUpperCase() %>
          </a>
        </div>
      </header>

      <!-- Hero Banner -->
      <section class="mb-8">
        <div class="relative overflow-hidden rounded-2xl shadow-md">
          <img src="https://images.unsplash.com/photo-1553877522-43269d4ea984?q=80&w=1400&auto=format&fit=crop" alt="Study banner" class="w-full h-56 object-cover">
          <div class="absolute inset-0 bg-gradient-to-r from-black/50 to-black/20"></div>
          <div class="absolute inset-0 p-6 flex flex-col justify-end">
            <h3 class="text-white text-2xl font-bold">Level up your English today</h3>
            <p class="text-white/90 text-sm mt-1">Quick practice, smart tips, and bite‑sized lessons to keep you moving.</p>
            <div class="mt-4 flex gap-3">
              <a href="/dashboard/lessons/Grammar" class="px-4 py-2 rounded-xl bg-white text-gray-900 text-sm font-semibold hover:bg-gray-100">Start a lesson</a>
              <a href="/dashboard/test" class="px-4 py-2 rounded-xl bg-teal-500 text-white text-sm font-semibold hover:bg-teal-600">Take a quick test</a>
            </div>
          </div>
        </div>
      </section>

      <!-- Spotlight & Tips (replaces static stats) -->
      <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-md">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="fas fa-compass text-teal-600"></i>
              Recommended for you
            </h3>
          </div>
          <div id="recommendations" class="grid sm:grid-cols-2 gap-4">
            <a href="/dashboard/lessons/Grammar" class="lesson-card flex items-center gap-4 p-4 rounded-xl bg-white border border-gray-200 hover:border-teal-400">
              <img src="https://images.unsplash.com/photo-1491841550275-ad7854e35ca6?q=80&w=600&auto=format&fit=crop" alt="Grammar" class="w-20 h-20 object-cover rounded-lg">
              <div>
                <div class="font-semibold text-gray-800">Revise a quick Grammar concept</div>
                <div class="text-xs text-gray-500 mt-1">Tenses, articles, prepositions</div>
              </div>
            </a>
            <a href="/dashboard/lessons/speaking" class="lesson-card flex items-center gap-4 p-4 rounded-xl bg-white border border-gray-200 hover:border-teal-400">
              <img src="https://images.unsplash.com/photo-1523245317828-629a697b4013?q=80&w=600&auto=format&fit=crop" alt="Speaking" class="w-20 h-20 object-cover rounded-lg">
              <div>
                <div class="font-semibold text-gray-800">Do a 2‑minute speaking drill</div>
                <div class="text-xs text-gray-500 mt-1">Pronunciation and fluency</div>
              </div>
            </a>
            <a href="/Vocabulary" class="lesson-card flex items-center gap-4 p-4 rounded-xl bg-white border border-gray-200 hover:border-teal-400">
              <img src="https://images.unsplash.com/photo-1516979187457-637abb4f9353?q=80&w=600&auto=format&fit=crop" alt="Vocabulary" class="w-20 h-20 object-cover rounded-lg">
              <div>
                <div class="font-semibold text-gray-800">Learn 5 new words today</div>
                <div class="text-xs text-gray-500 mt-1">Synonyms, usage, examples</div>
              </div>
            </a>
            <a href="/dashboard/test" class="lesson-card flex items-center gap-4 p-4 rounded-xl bg-white border border-gray-200 hover:border-teal-400">
              <img src="https://images.unsplash.com/photo-1523580846011-d3a5bc25702b?q=80&w=600&auto=format&fit=crop" alt="Test" class="w-20 h-20 object-cover rounded-lg">
              <div>
                <div class="font-semibold text-gray-800">Try a short practice test</div>
                <div class="text-xs text-gray-500 mt-1">10 questions • 5 minutes</div>
              </div>
            </a>
          </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-md">
          <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="fas fa-lightbulb text-yellow-500"></i>
            Daily tip
          </h4>
          <div id="dailyTip" class="text-sm text-gray-700">
            Loading tip...
          </div>
        </div>
      </section>

      <!-- Recent Activity & Achievements (moved here, replacing Quick Actions) -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Recent Activity -->
        <div class="bg-white p-6 rounded-2xl shadow-md">
          <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="fas fa-history text-blue-600"></i>
            Recent Activity
          </h4>
          <ul id="recentList" class="space-y-3">
            <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
              <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-spinner fa-spin text-blue-600"></i>
              </div>
              <span class="text-sm text-gray-600">Loading activity...</span>
            </li>
          </ul>
        </div>

        <!-- Achievements -->
        <div class="bg-white p-6 rounded-2xl shadow-md">
          <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <i class="fas fa-trophy text-yellow-500"></i>
            Recent Achievements
          </h4>
          <div class="grid grid-cols-3 gap-4">
            <div class="text-center p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl">
              <div class="text-3xl mb-2">🔥</div>
              <div class="text-xs font-semibold text-gray-700">7 Day Streak</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
              <div class="text-3xl mb-2">📚</div>
              <div class="text-xs font-semibold text-gray-700">Book Worm</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
              <div class="text-3xl mb-2">⭐</div>
              <div class="text-xs font-semibold text-gray-700">Rising Star</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
              <div class="text-3xl mb-2">🎯</div>
              <div class="text-xs font-semibold text-gray-700">Goal Getter</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl">
              <div class="text-3xl mb-2">💪</div>
              <div class="text-xs font-semibold text-gray-700">Consistent</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl opacity-50">
              <div class="text-3xl mb-2">🏆</div>
              <div class="text-xs font-semibold text-gray-700">Master</div>
            </div>
          </div>
        </div>
      </section>

      
    </div>
  </div>

  <!-- Notification container -->
  <div id="notify" class="notify hidden">
    <div class="bg-white p-4 rounded-xl shadow-2xl border-l-4 border-teal-500">
      <div class="flex items-start gap-3">
        <i class="fas fa-bell text-teal-500 text-xl mt-1"></i>
        <div>
          <div class="font-bold text-gray-800" id="notifyTitle">Notification</div>
          <div class="text-sm text-gray-600 mt-1" id="notifyBody">You have new updates.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Client JS -->
  <script>
    // Sidebar toggle
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');

    function toggleSidebar() {
      sidebar.classList.toggle('mobile-hidden');
      overlay.classList.toggle('hidden');
    }

    menuBtn?.addEventListener('click', toggleSidebar);

    // Submenu toggle
    function toggleSubmenu(menu) {
      const submenu = document.getElementById(menu + '-submenu');
      const arrow = document.getElementById(menu + '-arrow');

      if (submenu.classList.contains('hidden')) {
        submenu.classList.remove('hidden');
        arrow.classList.remove('fa-chevron-right');
        arrow.classList.add('fa-chevron-down');
      } else {
        submenu.classList.add('hidden');
        arrow.classList.remove('fa-chevron-down');
        arrow.classList.add('fa-chevron-right');
      }
    }

    // Notifications
    const notifyEl = document.getElementById('notify');
    const notifyBtn = document.getElementById('notifBtn');

    function showNotification(title, body) {
      document.getElementById('notifyTitle').textContent = title;
      document.getElementById('notifyBody').textContent = body;
      notifyEl.classList.remove('hidden');
      setTimeout(() => notifyEl.classList.add('hidden'), 5000);
    }

    notifyBtn?.addEventListener('click', () => {
      showNotification('Daily Reminder', 'Complete one lesson today to maintain your streak!');
    });

    // Daily tip + recent activity loader (no static numbers)
    async function fetchStats() {
      try {
        const res = await fetch('/api/stats');
        if (!res.ok) throw new Error('Failed to fetch stats');
        const data = await res.json();
        // Daily tip
        const tips = data.tips || [
          'Read aloud for 5 minutes to improve pronunciation.',
          'Learn new words in context, not in isolation.',
          'Record yourself speaking and listen back critically.',
          'Write a short paragraph daily on any topic.'
        ];
        const tip = tips[Math.floor(Math.random() * tips.length)];
        const tipEl = document.getElementById('dailyTip');
        if (tipEl) tipEl.textContent = tip;

        // Update recent activity
        updateRecentActivity(data.recentActivity || []);
      } catch (err) {
        console.error('Error fetching stats:', err);
        const tipEl = document.getElementById('dailyTip');
        if (tipEl) tipEl.textContent = 'Tip: Set a 10‑minute timer and practice one skill today.';
      }
    }

    function updateRecentActivity(activities) {
      const list = document.getElementById('recentList');
      list.innerHTML = '';

      if (!activities || activities.length === 0) {
        list.innerHTML = '<li class="text-sm text-gray-500 p-3">No recent activity. Start learning to see updates!</li>';
        return;
      }

      activities.slice(0, 5).forEach(activity => {
        const icons = {
          lesson: 'fa-book',
          vocab: 'fa-spell-check',
          test: 'fa-clipboard-check',
          speaking: 'fa-microphone'
        };
        const colors = {
          lesson: 'blue',
          vocab: 'green',
          test: 'purple',
          speaking: 'orange'
        };

        const icon = icons[activity.type] || 'fa-circle';
        const color = colors[activity.type] || 'gray';

        list.innerHTML += `
          <li class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
            <div class="w-10 h-10 bg-${color}-100 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas ${icon} text-${color}-600"></i>
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-medium text-gray-800 text-sm truncate">${activity.title}</div>
              <div class="text-xs text-gray-500">${activity.timeAgo}</div>
            </div>
            ${activity.xp ? <div class="text-green-600 font-bold text-sm">+${activity.xp} XP</div> : ''}
          </li>
        `;
      });
    }

    // Initialize
    fetchStats();

    // Refresh every 30 seconds
    setInterval(fetchStats, 30000);
  </script>

</body>
</html>